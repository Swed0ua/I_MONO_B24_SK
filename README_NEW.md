# SmartKasa Integration - –û–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Monobank API "–ü–æ–∫—É–ø–∫–∞ –ß–∞—Å—Ç–∏–Ω–∞–º–∏" –∑ Bitrix24 CRM –∑ –ø–æ–∫—Ä–∞—â–µ–Ω–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é.

## üöÄ –ù–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

### ‚úÖ **–ë–µ–∑–ø–µ—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å—É–º –Ω–∞ –±–µ–∫–µ–Ω–¥—ñ**
- –°—É–º–∏ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ, –Ω–µ –∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ü—ñ–Ω –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ–π –∑ —Å—É–º–∞–º–∏

### ‚úÖ **–ë–∞–∑–∞ —Ç–æ–≤–∞—Ä—ñ–≤**
- –ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏
- CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–ª—è —Ç–æ–≤–∞—Ä—ñ–≤
- –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–∞ –∞—Ä—Ç–∏–∫—É–ª–∏
- –ú'—è–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤

### ‚úÖ **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞**
- SOLID –ø—Ä–∏–Ω—Ü–∏–ø–∏
- Dependency Injection
- –ß—ñ—Ç–∫–µ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç–µ–π
- –õ–µ–≥–∫–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

## üìä –ù–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö

### –¢–æ–≤–∞—Ä–∏ (Products)
```json
{
  "id": 1,
  "name": "–¢–µ–ª–µ–≤–∏–∑–æ—Ä Samsung 55\"",
  "description": "4K UHD Smart TV –∑ HDR",
  "price": 25000.00,
  "sku": "TV-SAM-55-4K",
  "category": "–ï–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫–∞",
  "is_active": true
}
```

### –ó–∞–ø–∏—Ç –ø–ª–∞—Ç–µ–∂—É (–Ω–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç)
```json
{
  "store_order_id": "order_123",
  "client_phone": "+380000000001",
  "invoice": {
    "date": "2024-01-22",
    "number": "INV-001",
    "point_id": 1234,
    "source": "INTERNET"
  },
  "available_programs": [
    {
      "available_parts_count": [3, 4, 6, 9],
      "type": "payment_installments"
    }
  ],
  "products": [
    {
      "product_id": 1,
      "quantity": 1
    },
    {
      "product_id": 4,
      "quantity": 2
    }
  ],
  "result_callback": "https://your-store.com/callback"
}
```

## üîÑ –ù–æ–≤–∏–π workflow

1. **–§—Ä–æ–Ω—Ç–µ–Ω–¥** ‚Üí –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ (ID + –∫—ñ–ª—å–∫—ñ—Å—Ç—å)
2. **–ë–µ–∫–µ–Ω–¥** ‚Üí —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î —Å—É–º–∏ –∑ –ë–î —Ç–æ–≤–∞—Ä—ñ–≤
3. **–ë–µ–∫–µ–Ω–¥** ‚Üí –≤–∞–ª—ñ–¥—É—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Ç–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤
4. **–ë–µ–∫–µ–Ω–¥** ‚Üí —Å—Ç–≤–æ—Ä—é—î –ø–ª–∞—Ç–µ–∂ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ —Å—É–º–∞–º–∏
5. **–ë–µ–∫–µ–Ω–¥** ‚Üí –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –¥–æ Monobank

## üì° API Endpoints

### –¢–æ–≤–∞—Ä–∏
- `GET /api/v1/products/` - —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤
- `POST /api/v1/products/` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
- `GET /api/v1/products/{id}` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
- `PUT /api/v1/products/{id}` - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
- `DELETE /api/v1/products/{id}` - –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É

### –ü–ª–∞—Ç–µ–∂—ñ (–æ–Ω–æ–≤–ª–µ–Ω—ñ)
- `POST /api/v1/payments/calculate` - —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å—É–º–∏
- `POST /api/v1/payments/create` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—É
- `POST /api/v1/payments/validate` - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–ª—ñ—î–Ω—Ç–∞
- `GET /api/v1/payments/{id}/status` - —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂—É
- `POST /api/v1/payments/{id}/confirm` - –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è

## üõ† –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫

### 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ë–î
```bash
# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å
python scripts/init_db.py

# –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
python scripts/seed_products.py
```

### 3. –ó–∞–ø—É—Å–∫
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
python run.py

# –ê–±–æ —á–µ—Ä–µ–∑ Docker
docker-compose up -d
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–æ–≤–æ—ó –ª–æ–≥—ñ–∫–∏
```bash
python scripts/test_api_new.py
```

### –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
```python
# –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø–ª–∞—Ç–µ–∂—É
products = [
    {"product_id": 1, "quantity": 1},  # –¢–µ–ª–µ–≤–∏–∑–æ—Ä
    {"product_id": 4, "quantity": 2}   # –ù–∞–≤—É—à–Ω–∏–∫–∏
]

response = await client.post("/api/v1/payments/calculate", json=products)
# –û—Ç—Ä–∏–º–∞—î–º–æ: total_sum, products –∑ —Ü—ñ–Ω–∞–º–∏, calculated_at
```

## üîí –ë–µ–∑–ø–µ–∫–∞

- ‚úÖ –°—É–º–∏ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –Ω–∞ –±–µ–∫–µ–Ω–¥—ñ
- ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Å—ñ—Ö –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ç–æ–≤–∞—Ä—ñ–≤
- ‚úÖ HMAC –ø—ñ–¥–ø–∏—Å–∏ –¥–ª—è –≤–µ–±-—Ö—É–∫—ñ–≤
- ‚úÖ –ó–∞—Ö–∏—â–µ–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

## üìà –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

1. **–ë–µ–∑–ø–µ–∫–∞** - –Ω–µ–º–æ–∂–ª–∏–≤–æ –ø—ñ–¥—Ä–æ–±–∏—Ç–∏ —Å—É–º–∏
2. **–¢–æ—á–Ω—ñ—Å—Ç—å** - —Ü—ñ–Ω–∏ –∑–∞–≤–∂–¥–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ñ –∑ –ë–î
3. **–ì–Ω—É—á–∫—ñ—Å—Ç—å** - –ª–µ–≥–∫–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ü—ñ–Ω–∏
4. **–ê—É–¥–∏—Ç** - –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ü—ñ–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
5. **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏

## üéØ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

- [ ] –î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–æ–≤–∞—Ä—ñ–≤
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–Ω–∏–∂–∫–∏ —Ç–∞ –∞–∫—Ü—ñ—ó
- [ ] –î–æ–¥–∞—Ç–∏ —Å–∫–ª–∞–¥—Å—å–∫–∏–π –æ–±–ª—ñ–∫
- [ ] –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —Å–∏—Å—Ç–µ–º–∞–º–∏ –æ–±–ª—ñ–∫—É
- [ ] –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂—ñ–≤

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–ü—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø—Ä–æ–±–ª–µ–º –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:
1. –ß–∏ –∑–∞–ø—É—â–µ–Ω–∞ –ë–î PostgreSQL
2. –ß–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω–∞ –ë–î —Ç–µ—Å—Ç–æ–≤–∏–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
3. –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
4. –õ–æ–≥–∏ –¥–æ–¥–∞—Ç–∫—É –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –ø–æ–º–∏–ª–æ–∫
